# Phoenix Rooivalk Detector Environment Variables
# Copy this file to .env for local development
#
# Configuration priority (highest to lowest):
#   CLI args  >  environment variables  >  config file (YAML/JSON)  >  defaults
#
# Environment variables use the prefix of their settings group (e.g. CAPTURE_,
# INFERENCE_, TRACKER_, etc.). Nested settings use double-underscore as
# delimiter when loaded via pydantic-settings (e.g. INFERENCE__MODEL_PATH).
#
# For full settings documentation see: apps/detector/src/config/settings.py
# To generate a YAML config file run: drone-detector --generate-config config.yaml

# =============================================================================
# Top-Level Camera / Engine / Tracker Selection
# =============================================================================

# Camera source type
# Values: auto, picamera, usb, video, mock
# Default: auto (hardware auto-detection selects the best available source)
# CAMERA_TYPE=auto

# Inference engine backend
# Values: auto, tflite, onnx, coral, mock
# Default: auto (hardware auto-detection selects tflite on Pi, onnx on Jetson, etc.)
# ENGINE_TYPE=auto

# Object tracker type
# Values: none, centroid, kalman
# Default: centroid
# TRACKER_TYPE=centroid

# =============================================================================
# Capture Settings (prefix: CAPTURE_)
# =============================================================================

# Camera capture width in pixels (160–4096, default: 640)
# CAPTURE_WIDTH=640

# Camera capture height in pixels (120–3072, default: 480)
# CAPTURE_HEIGHT=480

# Target frames per second (1–120, default: 30)
# CAPTURE_FPS=30

# Frame buffer size — lower values reduce latency (1–10, default: 1)
# CAPTURE_BUFFER_SIZE=1

# USB camera device index (default: 0)
# CAPTURE_CAMERA_INDEX=0

# Video file path — used when CAMERA_TYPE=video (optional)
# CAPTURE_VIDEO_PATH=

# Loop video file playback (default: true)
# CAPTURE_VIDEO_LOOP=true

# =============================================================================
# Inference Settings (prefix: INFERENCE_)
# =============================================================================

# Path to the model file (.tflite or .onnx)
# Required unless running with --mock or engine=mock
INFERENCE_MODEL_PATH=

# Model input resolution (square, 128–640, default: 320)
# INFERENCE_INPUT_SIZE=320

# Minimum detection confidence threshold (0.0–1.0, default: 0.5)
# INFERENCE_CONFIDENCE_THRESHOLD=0.5

# Non-maximum suppression IoU threshold (0.0–1.0, default: 0.45)
# INFERENCE_NMS_THRESHOLD=0.45

# Number of CPU threads for inference (1–16, default: 4)
# INFERENCE_NUM_THREADS=4

# Use Coral Edge TPU if available (default: false)
# INFERENCE_USE_CORAL=false

# =============================================================================
# Tracker Settings (prefix: TRACKER_)
# =============================================================================

# Frames without detection before a track is deleted (1–300, default: 30)
# TRACKER_MAX_DISAPPEARED=30

# Maximum centroid distance for track matching in pixels (default: 100.0)
# TRACKER_MAX_DISTANCE=100.0

# Kalman filter process noise (default: 1.0)
# TRACKER_PROCESS_NOISE=1.0

# Kalman filter measurement noise (default: 1.0)
# TRACKER_MEASUREMENT_NOISE=1.0

# =============================================================================
# Targeting Settings (prefix: TARGETING_)
# =============================================================================
# Controls target locking and the fire-net engagement system.
# The fire net is DISABLED by default and requires explicit arming at runtime.

# Maximum distance for targeting estimation in metres (default: 100.0)
# TARGETING_MAX_TARGETING_DISTANCE_M=100.0

# Minimum model confidence to lock a target (0.3–1.0, default: 0.7)
# TARGETING_MIN_CONFIDENCE_FOR_LOCK=0.7

# Seconds before a target lock is lost without a new detection (default: 5.0)
# TARGETING_LOCK_TIMEOUT_SECONDS=5.0

# Enable fire-net system (DISABLED by default — safety critical)
# TARGETING_FIRE_NET_ENABLED=false

# Minimum confidence to trigger fire-net (default: 0.85)
# TARGETING_FIRE_NET_MIN_CONFIDENCE=0.85

# Minimum consecutive frames tracked before fire is permitted (default: 10)
# TARGETING_FIRE_NET_MIN_TRACK_FRAMES=10

# Maximum engagement distance in metres (5.0–200.0, default: 50.0)
# TARGETING_FIRE_NET_MAX_DISTANCE_M=50.0

# Minimum safe engagement distance in metres (1.0–50.0, default: 5.0)
# TARGETING_FIRE_NET_MIN_DISTANCE_M=5.0

# Maximum target velocity for fire in m/s (default: 30.0)
# TARGETING_FIRE_NET_VELOCITY_THRESHOLD_MS=30.0

# Cooldown between fire-net activations in seconds (default: 10.0)
# TARGETING_FIRE_NET_COOLDOWN_SECONDS=10.0

# Require explicit arming command before fire-net can trigger (default: true)
# TARGETING_FIRE_NET_ARM_REQUIRED=true

# GPIO pin (BCM numbering) for fire-net trigger output (2–27, default: 17)
# TARGETING_FIRE_NET_GPIO_PIN=17

# =============================================================================
# Turret Control Settings (prefix: TURRET_)
# =============================================================================

# Transport backend for pan/tilt hardware
# Values: simulated, serial, wifi_udp, audio_pwm (default: simulated)
# TURRET_TRANSPORT_TYPE=simulated

# Serial port for serial transport (default: /dev/ttyUSB0)
# TURRET_SERIAL_PORT=/dev/ttyUSB0

# Serial baud rate (default: 115200)
# TURRET_SERIAL_BAUDRATE=115200

# UDP target host for wifi_udp transport (default: 192.168.4.1)
# TURRET_WIFI_HOST=192.168.4.1

# UDP target port for wifi_udp transport (default: 4210)
# TURRET_WIFI_PORT=4210

# Audio output device index for audio_pwm transport (null = system default)
# Run `python -m sounddevice` to list available devices
# TURRET_AUDIO_DEVICE=

# Audio buffer size in samples — smaller values reduce latency (default: 512)
# TURRET_AUDIO_BUFFER_SIZE=512

# Starting authority mode: manual, assisted, auto_track (default: manual)
# TURRET_INITIAL_MODE=manual

# =============================================================================
# Alert Settings (prefix: ALERT_)
# =============================================================================

# Webhook URL for drone detection alerts (optional)
# Receives POST requests with detection JSON payload
ALERT_WEBHOOK_URL=

# Webhook request timeout in seconds (default: 5.0)
# ALERT_WEBHOOK_TIMEOUT=5.0

# Number of webhook retry attempts on failure (default: 3)
# ALERT_WEBHOOK_RETRY_COUNT=3

# Alert cooldown per track ID in seconds — prevents alert flooding (default: 5.0)
# ALERT_COOLDOWN_PER_TRACK=5.0

# Global alert cooldown across all tracks in seconds (default: 1.0)
# ALERT_GLOBAL_COOLDOWN=1.0

# Path to save detection events as JSON (optional, leave blank to disable)
# ALERT_SAVE_DETECTIONS_PATH=

# =============================================================================
# Streaming Settings (prefix: STREAM_)
# =============================================================================

# Enable MJPEG streaming server (default: false)
# STREAM_ENABLED=false

# Streaming server bind host (default: 0.0.0.0 — all interfaces on LAN)
# STREAM_HOST=0.0.0.0

# Streaming server port (default: 8080)
# STREAM_PORT=8080

# JPEG quality for stream frames (10–100, default: 80)
# STREAM_QUALITY=80

# Maximum stream frames per second (1–60, default: 15)
# STREAM_MAX_FPS=15

# Enable Bearer token authentication for the stream endpoint (default: false)
# STREAM_AUTH_ENABLED=false

# Bearer token for stream authentication (required if STREAM_AUTH_ENABLED=true)
# Required: set a strong random token when auth is enabled
STREAM_AUTH_TOKEN=

# =============================================================================
# Logging Settings (prefix: LOG_)
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL (default: INFO)
# LOG_LEVEL=INFO

# Use JSON-formatted log output (default: false)
# LOG_JSON_FORMAT=false

# Log file path (optional — logs to stdout if not set)
# LOG_LOG_FILE=

# Maximum log file size in bytes before rotation (default: 10000000 = 10 MB)
# LOG_MAX_BYTES=10000000

# Number of rotated log file backups to keep (default: 5)
# LOG_BACKUP_COUNT=5

# =============================================================================
# Display Settings (prefix: DISPLAY_)
# =============================================================================

# Run without a display window — required on headless systems (default: false)
# DISPLAY_HEADLESS=false

# OpenCV window title (default: Drone Detection)
# DISPLAY_WINDOW_NAME=Drone Detection

# Show FPS counter overlay (default: true)
# DISPLAY_SHOW_FPS=true

# Show drone likelihood score bar (default: true)
# DISPLAY_SHOW_DRONE_SCORE=true

# Show track IDs on bounding boxes (default: true)
# DISPLAY_SHOW_TRACK_ID=true

# Show estimated distance overlay (default: true)
# DISPLAY_SHOW_DISTANCE=true

# Show targeting status overlay (default: true)
# DISPLAY_SHOW_TARGETING_OVERLAY=true

# Log interval in frames when running headless (default: 30)
# DISPLAY_LOG_INTERVAL_FRAMES=30

# =============================================================================
# Display Server Detection (read-only, set by the OS)
# =============================================================================
# DISPLAY and WAYLAND_DISPLAY are standard Linux environment variables set
# automatically by the desktop session. The detector reads them to determine
# whether a display is available and whether to fall back to headless mode.
# Do not set these manually unless you know what you are doing.
# DISPLAY=:0
# WAYLAND_DISPLAY=wayland-0
